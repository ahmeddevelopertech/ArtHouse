<odoo>
    <!-- Inherit Invoice Report -->
    <template id="report_invoice_document_inherit" inherit_id="account.report_invoice_document">

        <!-- Add Labels to Customer Information - address_not_same_as_shipping -->
        <xpath expr="//div[@name='address_not_same_as_shipping']//address[@t-field='o.partner_id']" position="replace">
            <div>
                <div class="mb-1">
                    <strong>Customer Name:</strong>
                    <span t-field="o.partner_id.name"/>
                </div>
                <div class="mb-1">
                    <strong>Phone:</strong>
                    <span t-field="o.partner_id.phone"/>
                </div>
                <div class="mb-1">
                    <strong>Mobile:</strong>
                    <span t-field="o.partner_id.mobile"/>
                </div>
                <div class="mb-1">
                    <strong>Address:</strong>
                    <span t-field="o.partner_id.street"/>
                    <span t-if="o.partner_id.street2">,
                        <span t-field="o.partner_id.street2"/>
                    </span>
                    <span t-if="o.partner_id.city">,
                        <span t-field="o.partner_id.city"/>
                    </span>
                    <span t-if="o.partner_id.state_id">,
                        <span t-field="o.partner_id.state_id.name"/>
                    </span>
                    <span t-if="o.partner_id.zip">
                        <span t-field="o.partner_id.zip"/>
                    </span>
                    <span t-if="o.partner_id.country_id">,
                        <span t-field="o.partner_id.country_id.name"/>
                    </span>
                </div>
                <div class="mb-1" t-if="o.partner_id.email">
                    <strong>Email:</strong>
                    <span t-field="o.partner_id.email"/>
                </div>
            </div>
        </xpath>

        <!-- Add Labels to Customer Information - address_same_as_shipping -->
        <xpath expr="//div[@name='address_same_as_shipping']//address[@t-field='o.partner_id']" position="replace">
            <div>
                <div class="mb-1">
                    <strong>Customer Name:</strong>
                    <span t-field="o.partner_id.name"/>
                </div>
                <div class="mb-1">
                    <strong>Phone:</strong>
                    <span t-field="o.partner_id.phone"/>
                </div>
                <div class="mb-1">
                    <strong>Mobile:</strong>
                    <span t-field="o.partner_id.mobile"/>
                </div>
                <div class="mb-1">
                    <strong>Address:</strong>
                    <span t-field="o.partner_id.street"/>
                    <span t-if="o.partner_id.street2">,
                        <span t-field="o.partner_id.street2"/>
                    </span>
                    <span t-if="o.partner_id.city">,
                        <span t-field="o.partner_id.city"/>
                    </span>
                    <span t-if="o.partner_id.state_id">,
                        <span t-field="o.partner_id.state_id.name"/>
                    </span>
                    <span t-if="o.partner_id.zip">
                        <span t-field="o.partner_id.zip"/>
                    </span>
                    <span t-if="o.partner_id.country_id">,
                        <span t-field="o.partner_id.country_id.name"/>
                    </span>
                </div>
                <div class="mb-1" t-if="o.partner_id.email">
                    <strong>Email:</strong>
                    <span t-field="o.partner_id.email"/>
                </div>
            </div>
        </xpath>

        <!-- Add Labels to Customer Information - no_shipping -->
        <xpath expr="//div[@name='no_shipping']//address[@t-field='o.partner_id']" position="replace">
            <div>
                <div class="mb-1">
                    <strong>Customer Name:</strong>
                    <span t-field="o.partner_id.name"/>
                </div>
                <div class="mb-1" t-if="o.partner_id.phone">
                    <strong>Phone:</strong>
                    <span t-field="o.partner_id.phone"/>
                </div>
                <div class="mb-1">
                    <strong>Mobile:</strong>
                    <span t-field="o.partner_id.mobile"/>
                </div>
                <div class="mb-1">
                    <strong>Address:</strong>
                    <span t-field="o.partner_id.street"/>
                    <span t-if="o.partner_id.street2">,
                        <span t-field="o.partner_id.street2"/>
                    </span>
                    <span t-if="o.partner_id.city">,
                        <span t-field="o.partner_id.city"/>
                    </span>
                    <span t-if="o.partner_id.state_id">,
                        <span t-field="o.partner_id.state_id.name"/>
                    </span>
                    <span t-if="o.partner_id.zip">
                        <span t-field="o.partner_id.zip"/>
                    </span>
                    <span t-if="o.partner_id.country_id">,
                        <span t-field="o.partner_id.country_id.name"/>
                    </span>
                </div>
                <div class="mb-1" t-if="o.partner_id.email">
                    <strong>Email:</strong>
                    <span t-field="o.partner_id.email"/>
                </div>
            </div>
        </xpath>

        <!-- Add Product Name Column Header in Table -->
        <xpath expr="//table[@name='invoice_line_table']//thead//tr/th[@name='th_description']" position="before">
            <th name="th_product_name" class="text-start">
                <span>Product Name</span>
            </th>
        </xpath>

        <!-- Add Product Name Column in Table Body for product lines -->
        <xpath expr="//tbody[@class='invoice_tbody']//td[@name='account_invoice_line_name']" position="before">
            <td name="td_product_name" class="text-start">
                <span t-field="line.product_id.name"/>
            </td>
        </xpath>

        <!-- Add empty Product Name cell for line_section -->
        <xpath expr="//t[@t-elif=&quot;line.display_type == 'line_section'&quot;]/td" position="attributes">
            <attribute name="colspan">100</attribute>
        </xpath>

        <!-- Add empty Product Name cell for line_note -->
        <xpath expr="//t[@t-elif=&quot;line.display_type == 'line_note'&quot;]/td" position="attributes">
            <attribute name="colspan">100</attribute>
        </xpath>

        <xpath expr="//div[@class='mb-3']" position="after">
            <!-- Installments Section with INLINE CSS -->
            <t t-if="o.installment_ids">
                <style>
                    /* Odoo 17 compatible CSS injection */
                    .o_invoice_payment_table {
                    margin-top: 20px;
                    border-collapse: collapse;
                    width: 100%;
                    }
                    .o_invoice_payment_table th,
                    .o_invoice_payment_table td {
                    border: 1px solid #ddd;
                    padding: 8px;
                    text-align: left;
                    }
                    .o_invoice_payment_table th {
                    background-color: #f8f9fa;
                    font-weight: 600;
                    }
                    .o_invoice_payment_table tr.border-top {
                    border-top: 2px solid #666;
                    }
                </style>

                <div class="page">
                    <div class="oe_structure"/>
                    <div class="container">
                        <div class="row mt32 mb32">
                            <div class="col">
                                <h3 class="mt-4">Payment Plan</h3>
                                <table class="table table-sm o_invoice_payment_table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Description</th>
                                            <th>Status</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Fixed: Use counter variable instead of loop.index -->
                                        <t t-set="counter" t-value="0"/>
                                        <t t-foreach="o.installment_ids" t-as="installment">
                                            <t t-set="counter" t-value="counter + 1"/>
                                            <tr>
                                                <td>
                                                    <span t-esc="installment.due_date.strftime('%d %b %Y')"/>
                                                </td>
                                                <td>
                                                    <span t-esc="'Installment ' + str(counter)"/>
                                                </td>
                                                <td>
                                                    <span t-esc="installment.state"/>
                                                </td>
                                                <td class="text-end">
                                                    <span t-esc="installment.amount"
                                                          t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                                </td>
                                            </tr>
                                        </t>
                                        <tr class="border-top">
                                            <td colspan="3" class="text-center">
                                                <strong>Total Installments:</strong>
                                            </td>
                                            <td class="text-end">
                                                <strong t-esc="o.installment_total"
                                                        t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </xpath>

    </template>
</odoo>

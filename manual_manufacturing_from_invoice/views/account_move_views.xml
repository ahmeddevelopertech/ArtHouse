<odoo>
    <!-- Add sent to factory fields to invoice form -->
    <record id="view_move_form_inherit_send_to_factory" model="ir.ui.view">
        <field name="name">account.move.form.inherit.send_to_factory</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <!-- CORRECTED XPATH: Using proper Enterprise anchor point -->
            <xpath expr="//button[@id='account_invoice_payment_btn']" position="after">
                <button
                        name="action_send_to_factory"
                        type="object"
                        class="btn-secondary"
                        string="Send to Factory"
                        invisible="state != 'posted'  or manufacturing_status == 'sent_to_manufacturing' or move_type not in ('out_invoice', 'out_refund')"
                        context="{'dialog_size': 'medium'}"
                />
            </xpath>

            <xpath expr="//field[@name='state']" position="after">
                <!-- Field name must match EXACTLY -->
                <field name="manufacturing_status" readonly="1" widget="statusbar" invisible="move_type not in ('out_invoice', 'out_refund')"/>
            </xpath>

                 <xpath expr="//field[@name='invoice_date']" position="after">
                <!-- Field name must match EXACTLY -->
                <field name="delivery_date" readonly="state != 'draft'" invisible="move_type not in ('out_invoice', 'out_refund')"/>
            </xpath>

            <!-- Add sent to factory info to header -->
            <!--            <xpath expr="//div[hasclass('o_status')]" position="inside">-->
            <!--                <div class="mt8" attrs="{'invisible': [('sent_to_factory', '=', False)]}">-->
            <!--                    <span class="badge bg-success o_status">-->
            <!--                        <i class="fa fa-check-circle me-1" title="Sent to Factory"/>-->
            <!--                        <span t-esc="_('Sent to Factory')"/>-->
            <!--                        <t t-if="sent_to_factory_date">-->
            <!--                            <span t-esc="_(' on %s by %s') % (sent_to_factory_date.strftime('%d %b %Y %H:%M'), sent_to_factory_user_id.name)"/>-->
            <!--                        </t>-->
            <!--                    </span>-->
            <!--                </div>-->
            <!--            </xpath>-->
        </field>
    </record>
</odoo>